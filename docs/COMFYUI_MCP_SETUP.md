# ComfyUI MCP Server - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ComfyUI, –ø–æ–∑–≤–æ–ª—è—è AI –∞–≥–µ–Ω—Ç–∞–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ ComfyUI.

## –°—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏

‚úÖ **MCP —Å–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω**
‚úÖ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**
‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç**
‚ö†Ô∏è **ComfyUI —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–æ–±–ª–µ–º–∞ —Å lzma –º–æ–¥—É–ª–µ–º)**

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- `comfyui-mcp-server/server.py` - –û—Å–Ω–æ–≤–Ω–æ–π MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è ComfyUI
- `comfyui-mcp-server/test_server.py` - –¢–µ—Å—Ç–æ–≤—ã–π MCP —Å–µ—Ä–≤–µ—Ä (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ ComfyUI)
- `comfyui-mcp-server/comfyui_client.py` - –ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å ComfyUI
- `comfyui-mcp-server/client.py` - –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Cursor
- `cursor_comfyui_mcp_config.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞
- `cursor_test_mcp_config.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `comfyui-mcp-server/test_client.py` - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
- `comfyui-mcp-server/test_server.log` - –õ–æ–≥ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç–æ–≤—ã–π MCP —Å–µ—Ä–≤–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)

–¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ ComfyUI –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç mock-–æ—Ç–≤–µ—Ç—ã.

**–ó–∞–ø—É—Å–∫:**
```bash
cd comfyui-mcp-server
python test_server.py
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
python test_client.py
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cursor:**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `cursor_test_mcp_config.json`

### 2. –û—Å–Ω–æ–≤–Ω–æ–π MCP —Å–µ—Ä–≤–µ—Ä (—Ç—Ä–µ–±—É–µ—Ç ComfyUI)

**–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. ComfyUI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ `localhost:8188`
2. –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–ó–∞–ø—É—Å–∫ ComfyUI:**
```bash
cd ComfyUI_temp
python main.py --port 8188
```

**–ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
cd comfyui-mcp-server
python server.py
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cursor:**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `cursor_comfyui_mcp_config.json`

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ —Å ComfyUI (lzma –º–æ–¥—É–ª—å)

**–ü—Ä–æ–±–ª–µ–º–∞:** ComfyUI –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –º–æ–¥—É–ª—è `_lzma`
```
ModuleNotFoundError: No module named '_lzma'
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Homebrew (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω):**
   ```bash
   brew install xz
   pyenv install 3.12.0  # –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
   ```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ Python:**
   ```bash
   /usr/bin/python3 -m pip install -r requirements.txt
   /usr/bin/python3 main.py --port 8188
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ conda/miniconda:**
   ```bash
   conda create -n comfyui python=3.12
   conda activate comfyui
   pip install -r requirements.txt
   ```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞

**–£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**
```
üß™ Starting MCP Server Tests
==================================================

üîç Test 1: Basic connection and mock response
Connecting to Test MCP server...
‚úÖ Connected to Test MCP server
üì§ Sending request: {...}
‚è≥ Waiting for response...
üì• Response received:
{
  "image_url": "http://localhost:8188/mock_image_1024x768.png",
  "prompt": "a beautiful landscape with mountains",
  "dimensions": "1024x768",
  "status": "success",
  "message": "Mock image generated successfully"
}
‚úÖ Success! Mock image URL received

‚úÖ All tests passed!
```

## API

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

**Endpoint:** `ws://localhost:9000`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "tool": "test_tool",
  "params": "{\"prompt\": \"–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\", \"width\": 1024, \"height\": 768}"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "image_url": "http://localhost:8188/mock_image_1024x768.png",
  "prompt": "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è",
  "dimensions": "1024x768",
  "status": "success",
  "message": "Mock image generated successfully"
}
```

### –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä (—Å ComfyUI)

**Endpoint:** `ws://localhost:9000`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "tool": "generate_image",
  "params": "{\"prompt\": \"–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\", \"width\": 1024, \"height\": 768, \"workflow_id\": \"basic_api_test\", \"model\": \"v1-5-pruned-emaonly.ckpt\"}"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "image_url": "http://localhost:8188/view?filename=ComfyUI_00001_.png&subfolder=&type=output"
}
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π MCP —Å–µ—Ä–≤–µ—Ä —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π `cursor_test_mcp_config.json`

2. **–î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:** –†–µ—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å ComfyUI (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ lzma –º–æ–¥—É–ª—è) –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Cursor:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MCP –≤ Cursor

## –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| MCP —Å–µ—Ä–≤–µ—Ä | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω |
| WebSocket | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç |
| ComfyUI | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ | –¢—Ä–µ–±—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å lzma |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã | –í—Å–µ Python –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | ‚úÖ –ì–æ—Ç–æ–≤–∞ | –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã |

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `cat test_server.log`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python test_client.py`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `pip list | grep -E "(mcp|websockets|requests)"` 